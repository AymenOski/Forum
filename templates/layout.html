<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/css/layout.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
  <title>Forum</title>
</head>

<body>
  <!-- NavBar section -->
  <input type="radio" id="theme-pink" name="theme" class="theme-radio" />
  <input type="radio" id="theme-aqua" name="theme" class="theme-radio" />
  <input type="radio" id="theme-forest" name="theme" class="theme-radio" />
  <input type="radio" id="theme-dark" name="theme" class="theme-radio" checked />

  <header class="navbar">
    <div id="in-logo">
      <div class="logo-box">Forum</div>
      <a href="/"></a>
    </div>
    <nav class="nav-links">
      <div class="auth-buttons">
        <a href="/login">Login</a>
        <a href="/signup">Register</a>
      </div>
      <div class="themes">
        <div class="theme-buttons">
          <label for="theme-pink">🌸</label>
          <label for="theme-aqua">🌊</label>
          <label for="theme-forest">🌲</label>
          <label for="theme-dark">🌙</label>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <!-- Filtering and Posting section -->
    <div class="post-toggle-wrapper">
      <input type="radio" name="post-toggle" id="show-filter" checked hidden />
      <input type="radio" name="post-toggle" id="show-create" hidden />

      <div class="toggle-buttons">
        <label for="show-filter">🔍 Filter Posts</label>
        <label for="show-create">➕ Make a Post</label>
      </div>

      <div class="post-sections">
        <!-- Filter Form -->
        <div class="post-section filter-section">
          <form method="GET" action="/posts/filter">
            {{if .form_error}}
            <input type="checkbox" id="error-create-post" class="error-toggle" checked hidden />
            <div class="error-popout">
              <label for="error-create-post" class="error-close">x</label>
              <p class="error-message">{{.form_error}}</p>
            </div>
            {{end}}

            <div class="filter-options">
              <h4>Filter by Categories:</h4>
              <div class="category-tags-filter">
                {{range .categories}}
                <label class="category-tag">
                  <input type="checkbox" name="category" value="{{.ID}}" />
                  <span>{{.Name}}</span>
                </label>
                {{end}}
              </div>
            </div>

            <div class="filter-checkboxes">
              <label class="filter-option">
                <input type="checkbox" name="myPosts" />
                <span>My Posts</span>
              </label>
              <label class="filter-option">
                <input type="checkbox" name="likedPosts" />
                <span>Liked Posts</span>
              </label>
            </div>

            <button type="submit">Apply Filters</button>
          </form>
        </div>

        <!-- Create Post Form -->
        <div class="post-section create-section">
          <form method="POST" action="/post/create">
            {{if .form_error}}
            <input type="checkbox" id="error-create-post" class="error-toggle" checked hidden />
            <div class="error-popout">
              <label for="error-create-post" class="error-close">x</label>
              <p class="error-message">{{.form_error}}</p>
            </div>
            {{end}}

            <textarea name="content" placeholder="Write your post..." required maxlength="500">{{.Content}}</textarea>

            <h4>Select Categories:</h4>
            <div class="category-options">
              {{range .categories}}
              <label class="category-tag">
                <input type="checkbox" name="categories" value="{{.Name}}"
                  {{if $.selectedCategories}}{{if (index $.selectedCategories .Name)}}checked{{end}}{{end}} />
                <span>{{.Name}}</span>
              </label>
              {{end}}
            </div>

            <button type="submit">Post</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Published Posts Section -->
    <section class="posts-container">
      <h2 class="posts-title">Published Posts</h2>

      {{if .posts}}
      {{range .posts}}
      <article class="forum-post">
        <div class="post-header">
          <span class="post-author">Posted by {{.Author.UserName}}</span>
          <span class="post-date">{{.CreatedAt.Format "Jan 02, 2006 15:04"}}</span>
        </div>
        <div class="post-content">{{.Content}}</div>
        <div class="post-footer">
          <div class="post-categories">
            {{range .Categories}}
            <span class="category-badge">{{.Name}}</span>
            {{end}}
          </div>
          <div class="post-stats">
            <span class="likes">👍 {{.LikeCount}}</span>
            <span class="dislikes">👎 {{.DislikeCount}}</span>
            <span class="comments">💬 {{len .Comments}} comments</span>
          </div>
        </div>
      </article>
      {{end}}
      {{else}}
      <p>No posts available.</p>
      {{end}}
    </section>
  </main>
</body>

</html>
